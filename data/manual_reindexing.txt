Manual ReindexingThis page has been adopted from Running a Bulk ReindexContextThere are any number of scenarios which may require a ‘manual’ reindex (as opposed to a sync which may be kicked off by the reindex organization admin script), including but not limited to:* Raising/lowering the number of shards provisioned for an index* Moving organizations to/from single/multi-tenant indices* Moving organizations between clusters* Fixing version mismatchesGenerally speaking, a resynchronization also involves a reindex, but a ‘manual’ reindex will fully recreate the index from aggrergate data. This document outlines the steps involved.StepsAt the time of writing, we recommend using the indexing:bulk_reindex_organizations rake task even if you are only reindexing a single organization. It includes an interactive prompt which makes configuration easy, and defers the actual reindexing to the background.Note that only one bulk reindex may be running at a time.1. Begin the rake tasksal k8s run-cmd -n indexing-service --context production -- rake indexing:bulk_reindex_organizations2. Select the desired index type (the current state if just reindexing, the alternative state if migrating)3. Welcome to the Bulk Reindexing Wizard!4. This task is intended to reindex organizations in bulk.5. What kind of reindex run would you like to kick off? (Press ?/? arrow to move and Enter to select)6. ? single_tenant7.   multitenant  shift_to_multitenant8. Specify the batch size for bulk reindexes (how many indices/organizations to process at a time)How many indexes would you like to process at a time? (1)9. Select the desired entity type(s) - subsequent settings will apply to all selected entity types10. What entity types should be targeted for a reindex? (min. 1) (Press ?/? arrow to move, Space/Ctrl+A|R to select (all|rev) and Enter to finish)11. ? ? product_aggregate12.   ? digital_asset_aggregate  ? task_aggregate13. Determine whether you will be reindexing more than 10 organizations totalWill you want to reindex more than 10 organizations? (Y/n)5a. If no, provide organization system IDs directlyWhich organizations should be reindexed?(string-ified, comma-separated list of organization system_ids please!)5b. If yes, provide the S3 key of a file uploaded to the salsify-indexing-service-production bucket under bulk-reindexing/ (for example, the file bulk-reindexing/org-batch would be specified as just org-batch)Note that you must sal k8s elevate in order to upload objects to S3 via AWS UIA file with a string-ified, white-space-separated list of organization system_ids should be provided in salsify-indexing-service-production/bulk-reindexing on S3!What is the key (name) of the file with the organization's you'd like to reindex?6. Determine whether you need to customize any more settings for each new index7. Overriding any of the configured fields will override it for ALL ORGS in this reindex run.Would you like to override the existing index allocation configurations? (Y/n)If skipped then organizations will inherit the same settings used before the reindex, otherwise the supported settings are as follows:SettingType / RangeNotesshard countint (1-5)Defaults to 1, larger organizations/indices may benefit from more shardsschema nameenum (each aggregate type’s supported schemas)You should almost never need to customize thiscluster IDint (see indexing-service ES Cluster Topology)You only need to customize this for the products of quarantined organizations (Belk & Mattel)target index IDintYou should only need to customize this when reindexing onto a specific, existing multitenant index7. Finally, review the proposed reindex and either proceed or exit:8. +---------------------------------------------------------------------------------------------------+9. | Organizations Staged for SINGLE_TENANT Reindex in batches of 1 for Entities: [:product_aggregate] |10. +-------------------------------------------------+-------------------------------------------------+11. | System ID                                       | Organization Type                               |12. +-------------------------------------------------+-------------------------------------------------+13. | s-8d4b88e9-f280-469f-9535-c29e04fefdb4          | internal                                        |14. +-------------------------------------------------+-------------------------------------------------+Is this correct? (Y/n)15. Monitor the progress/success of the background reindex by referring to this dashboard: https://onenr.io/0ERPr7rJgQW