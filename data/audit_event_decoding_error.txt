Audit Service Event Decoding Error RunbookHistory04 Feb 2025At 13:26:23 UTC (08:26:23 EST), the audits-service-go-audit-indexer started crashing with the following error:error decoding event: cannot decode binary record "com.salsify.core.product_updated_event_value" field "action": cannot decode binary union: index ought to be between 0 and 2; read index: -58The Ruby checker process also encountered an error:NoMethodErrorundefined method `type_sym' for nil w_type = writers_schema.type_symWe determined the issue to be a result of a com.salsify.core.digital_asset_destroyed_event_value being assigned the incorrect schema ID of 1323 which corresponds to com.salsify.core.product_updated_event_value:The logs of the Avro Schema Registry didn’t show any requests at that time leading us to believe that the request was served from the CloudFront Distribution that sits in front of the Registry. At the time of writing, we don’t know of any ways to further investigate why the incorrect schema ID was returned as we don’t have logging enabled for the Distribution.Regardless, the immediate resolution was to catch the error and skip the event to allow processing to continue.ActionsWe have changed the handling of these sorts of events so that they don’t bring the whole consumer to a halt. However, if this occurs again, we should continue to search for more information about what causes it.